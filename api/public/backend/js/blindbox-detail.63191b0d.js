"use strict";(self["webpackChunkscui"]=self["webpackChunkscui"]||[]).push([[4755],{2388:function(e,t,a){a.r(t),a.d(t,{default:function(){return D}});var l=a(7267),i=a(5710);const o=e=>((0,l.Qi)("data-v-0b7e8009"),e=e(),(0,l.jt)(),e),d={class:"click-bar",style:{width:"300px",display:"flex"}},s=(0,l.eW)("返回列表 "),n=o((()=>(0,l.Lk)("span",{style:{"font-size":"14px","font-weight":"700","margin-left":"20px"}},"盲盒奖品详情",-1))),b={style:{display:"flex"}},r=(0,l.eW)("添加奖品"),h={style:{"margin-top":"20px","margin-left":"50px"}},p=(0,l.eW)(" 当前设定的概率为："),g=(0,l.eW)("，必须配置满100%！ "),u=o((()=>(0,l.Lk)("div",{style:{width:"100%",height:"0","border-bottom":"#e4e7ed 1px dashed","margin-top":"15px"}},null,-1))),c=(0,l.eW)("%"),y={key:1},m={key:1},k=(0,l.eW)("删除"),x=(0,l.eW)("保存奖品"),_=(0,l.eW)("生成箱子");function f(e,t,a,o,f,F){const w=(0,l.g2)("el-icon-arrow-left"),v=(0,l.g2)("el-icon"),P=(0,l.g2)("el-card"),D=(0,l.g2)("el-button"),C=(0,l.g2)("el-tag"),V=(0,l.g2)("el-table-column"),$=(0,l.g2)("el-image"),I=(0,l.g2)("el-option"),W=(0,l.g2)("el-select"),B=(0,l.g2)("el-input"),T=(0,l.g2)("el-table"),L=(0,l.g2)("el-form-item"),S=(0,l.g2)("el-form"),U=(0,l.g2)("Goods"),X=(0,l.g2)("el-dialog"),A=(0,l.g2)("el-main");return(0,l.uX)(),(0,l.Wv)(A,null,{default:(0,l.k6)((()=>[(0,l.bF)(P,{shadow:"false",style:{display:"flex"}},{default:(0,l.k6)((()=>[(0,l.Lk)("div",d,[(0,l.Lk)("div",{onClick:t[0]||(t[0]=e=>F.goBack()),style:{cursor:"pointer"}},[(0,l.bF)(v,{class:"back-icon"},{default:(0,l.k6)((()=>[(0,l.bF)(w)])),_:1}),s]),n])])),_:1}),(0,l.bF)(P,{shadow:"never"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",b,[(0,l.bF)(D,{type:"primary",icon:"el-icon-plus",onClick:F.addBlindbox,style:{"margin-top":"15px"}},{default:(0,l.k6)((()=>[r])),_:1},8,["onClick"]),(0,l.Lk)("div",h,[p,(0,l.bF)(C,{type:"danger"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(f.totalProbability)+"%",1)])),_:1}),g])]),u,(0,l.bF)(T,{data:f.tableData,style:{width:"100%","margin-top":"20px"}},{default:(0,l.k6)((()=>[(0,l.bF)(V,{prop:"goods_name",label:"商品名称"}),(0,l.bF)(V,{label:"商品图片"},{default:(0,l.k6)((e=>[(0,l.bF)($,{src:e.row.goods_image.split(",")[0],style:{height:"36px",width:"36px"}},null,8,["src"])])),_:1}),(0,l.bF)(V,{label:"赏种"},{default:(0,l.k6)((e=>[(0,l.bF)(W,{modelValue:e.row.tag_id,"onUpdate:modelValue":t=>e.row.tag_id=t,placeholder:"请选择",style:{width:"150px"},onChange:t=>F.selectType(e.$index)},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(f.goodsTag,(e=>((0,l.uX)(),(0,l.Wv)(I,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),(0,l.bF)(V,{prop:"price",label:"售价"}),(0,l.bF)(V,{prop:"recovery_price",label:"可兑换哈希币"}),(0,l.bF)(V,{label:"中奖概率%"},{default:(0,l.k6)((e=>[e.row.tag_id>0?((0,l.uX)(),(0,l.Wv)(B,{key:0,style:{width:"150px"},modelValue:e.row.probability,"onUpdate:modelValue":t=>e.row.probability=t,onBlur:F.resetProbaility},{append:(0,l.k6)((()=>[c])),_:2},1032,["modelValue","onUpdate:modelValue","onBlur"])):((0,l.uX)(),(0,l.CE)("span",y,"/"))])),_:1}),(0,l.bF)(V,{prop:"stock",label:"库存"},{default:(0,l.k6)((e=>[0!=e.row.tag_id?((0,l.uX)(),(0,l.Wv)(B,{key:0,modelValue:e.row.stock,"onUpdate:modelValue":t=>e.row.stock=t,type:"number",onChange:F.changeProbaility,style:{width:"150px"}},null,8,["modelValue","onUpdate:modelValue","onChange"])):((0,l.uX)(),(0,l.CE)("span",m,"/"))])),_:1}),(0,l.bF)(V,{label:"操作",fixed:"right",width:"140"},{default:(0,l.k6)((e=>[(0,l.bF)(D,{onClick:t=>F.handleDel(e.$index),type:"text",size:"small"},{default:(0,l.k6)((()=>[k])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),(0,l.bF)(D,{type:"danger",icon:"el-icon-document",onClick:F.saveBlindbox,style:{"margin-top":"15px"}},{default:(0,l.k6)((()=>[x])),_:1},8,["onClick"])])),_:1}),1!=f.playId&&3!=f.playId||f.hasSet?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(P,{key:0,shadow:"never"},{default:(0,l.k6)((()=>[(0,l.bF)(S,{ref:"form",model:f.boxForm,"label-width":"80px"},{default:(0,l.k6)((()=>[(0,l.bF)(L,{label:"箱子数量"},{default:(0,l.k6)((()=>[(0,l.bF)(B,{modelValue:f.boxForm.num,"onUpdate:modelValue":t[1]||(t[1]=e=>f.boxForm.num=e),type:"number",style:{width:"300px"}},null,8,["modelValue"])])),_:1}),(0,l.bF)(D,{type:"danger",icon:"el-icon-document",onClick:F.makeBox,style:{"margin-top":"15px"}},{default:(0,l.k6)((()=>[_])),_:1},8,["onClick"])])),_:1},8,["model"])])),_:1})),(0,l.bF)(X,{title:"奖品选择",modelValue:f.dialog.goods,"onUpdate:modelValue":t[2]||(t[2]=e=>f.dialog.goods=e),"destroy-on-close":"",width:"50%"},{default:(0,l.k6)((()=>[(0,l.bF)(U,{selectedgoods:f.selectedGoods,onHandleSelected:F.handleSelected,"goods-type":2},null,8,["selectedgoods","onHandleSelected"])])),_:1},8,["modelValue"])])),_:1})}a(7414);var F=a(7561),w={name:"goodsCate",components:{Goods:F.A},data(){return{dialog:{save:!1,goods:!1},boxForm:{blindbox_id:this.$route.query.id,num:0},tableData:[],blindbox_id:this.$route.query.id,totalProbability:0,goodsTag:[],hasSet:!1,playId:this.$route.query.play_id,selectedGoods:[]}},mounted(){this.getList(),this.getBlindboxTag()},methods:{changeProbaility(){this.totalProbability=0;let e=0;this.tableData.forEach((t=>{e+=parseInt(t.stock)})),this.tableData.forEach(((t,a)=>{this.tableData[a].probability=0==e?parseInt(0):(t.stock/e*100).toFixed(3),this.totalProbability+=1e3*this.tableData[a].probability})),this.totalProbability=(this.totalProbability/1e3).toFixed(3)},resetProbaility(){this.totalProbability=0,this.tableData.forEach((e=>{this.totalProbability+=1e3*e.probability})),this.totalProbability=(this.totalProbability/1e3).toFixed(3)},addBlindbox(){this.dialog.goods=!0},handleEdit(e){this.dialog.save=!0,this.$nextTick((()=>{this.$refs.saveDialog.open("edit").setData(e)}))},handleDel(e){this.tableData.splice(e,1),this.changeProbaility()},async getList(){let e=await this.$API.blindboxDetail.list.get({blindbox_id:this.blindbox_id});this.tableData=e.data,e.data.length>0&&(this.hasSet=!0),this.resetProbaility()},handleSuccess(){this.getList()},async getBlindboxTag(){let e=await this.$API.blindboxTag.list.get({limit:9999999,page:1,status:1,hashmart_auth_skip:1});this.goodsTag=e.data.rows,1!=this.playId&&3!=this.playId||this.goodsTag.push({id:0,name:"LAST"})},goBack(){this.$router.push({path:"/blindbox/index"})},async saveBlindbox(){if(100!=this.totalProbability)return this.$message.error("当前概率设置错误，总概率不是100%"),!1;let e=await this.$API.blindboxDetail.add.post({play_id:this.playId,data:this.tableData,blindbox_id:this.blindbox_id});0==e.code?this.$message.success("保存成功"):this.$message.error(e.msg)},handleSelected(e){this.tableData.push({blindbox_id:this.blindbox_id,tag_id:"",goods_id:e[0].id,goods_name:e[0].name,goods_image:e[0].image,price:e[0].price,recovery_price:e[0].recovery_price,stock:1,probability:0}),this.dialog.goods=!1},selectType(e){let t=this.tableData[e].tag_id;t<=0?(this.tableData[e].probability=0,this.tableData[e].stock=1):this.changeProbaility()},async makeBox(){if(this.boxForm.num<=0)return this.$message.error("箱子数量必须大于0"),!1;let e=await this.$API.blindboxDetail.box.post(this.boxForm);0==e.code?this.$message.success("生成箱子成功"):this.$message.error(e.msg)}}},v=a(1456);const P=(0,v.A)(w,[["render",f],["__scopeId","data-v-0b7e8009"]]);var D=P}}]);