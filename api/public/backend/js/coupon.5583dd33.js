"use strict";(self["webpackChunkscui"]=self["webpackChunkscui"]||[]).push([[9745],{9593:function(e,a,l){l.r(a),l.d(a,{default:function(){return X}});var t=l(7267),o=l(5710);const s=e=>((0,t.Qi)("data-v-70447ee4"),e=e(),(0,t.jt)(),e),i={class:"search-box"},n=(0,t.eW)("全部"),d=(0,t.eW)("进行中"),r=(0,t.eW)("已作废"),u=(0,t.eW)("已领完"),c=(0,t.eW)("查询"),g=s((()=>(0,t.Lk)("div",{style:{width:"100%",height:"0","border-bottom":"#e4e7ed 1px dashed","margin-bottom":"10px"}},null,-1))),h=(0,t.eW)("添加优惠券"),p=s((()=>(0,t.Lk)("div",{style:{width:"100%",height:"0","border-bottom":"#e4e7ed 1px dashed","margin-top":"15px"}},null,-1))),m=(0,t.eW)("满减券"),b=(0,t.eW)("折扣券"),k={key:0},F={key:1},_={key:0},f={key:1},v=(0,t.eW)("查看"),C=(0,t.eW)("领取记录"),y=(0,t.eW)("发放"),w=(0,t.eW)("作废"),x={shadow:"never",style:{border:"none"}},L=(0,t.eW)("查询");function W(e,a,l,s,W,D){const T=(0,t.g2)("el-button"),V=(0,t.g2)("el-button-group"),$=(0,t.g2)("el-form-item"),S=(0,t.g2)("el-form"),X=(0,t.g2)("el-input"),I=(0,t.g2)("el-table-column"),z=(0,t.g2)("el-tag"),P=(0,t.g2)("el-switch"),Q=(0,t.g2)("el-table"),A=(0,t.g2)("el-pagination"),U=(0,t.g2)("el-card"),E=(0,t.g2)("save-dialog"),R=(0,t.g2)("send-dialog"),B=(0,t.g2)("el-dialog"),O=(0,t.g2)("el-main");return(0,t.uX)(),(0,t.Wv)(O,null,{default:(0,t.k6)((()=>[(0,t.bF)(U,{shadow:"never"},{default:(0,t.k6)((()=>[(0,t.Lk)("div",i,[(0,t.bF)(S,{model:W.searchForm,"label-width":"80px"},{default:(0,t.k6)((()=>[(0,t.bF)($,{label:"状态"},{default:(0,t.k6)((()=>[(0,t.bF)(V,null,{default:(0,t.k6)((()=>[(0,t.bF)(T,{class:(0,o.C4)({primary:0==W.searchForm.status}),onClick:a[0]||(a[0]=e=>D.checkTab(0))},{default:(0,t.k6)((()=>[n])),_:1},8,["class"]),(0,t.bF)(T,{class:(0,o.C4)({primary:1==W.searchForm.status}),onClick:a[1]||(a[1]=e=>D.checkTab(1))},{default:(0,t.k6)((()=>[d])),_:1},8,["class"]),(0,t.bF)(T,{class:(0,o.C4)({primary:2==W.searchForm.status}),onClick:a[2]||(a[2]=e=>D.checkTab(2))},{default:(0,t.k6)((()=>[r])),_:1},8,["class"]),(0,t.bF)(T,{class:(0,o.C4)({primary:4==W.searchForm.status}),onClick:a[3]||(a[3]=e=>D.checkTab(4))},{default:(0,t.k6)((()=>[u])),_:1},8,["class"])])),_:1})])),_:1})])),_:1},8,["model"]),(0,t.bF)(S,{inline:!0,model:W.searchForm,class:"demo-form-inline","label-width":"80px"},{default:(0,t.k6)((()=>[(0,t.bF)($,{label:"优惠券名"},{default:(0,t.k6)((()=>[(0,t.bF)(X,{modelValue:W.searchForm.name,"onUpdate:modelValue":a[4]||(a[4]=e=>W.searchForm.name=e),placeholder:"",clearable:""},null,8,["modelValue"])])),_:1}),(0,t.bF)($,null,{default:(0,t.k6)((()=>[(0,t.bF)(T,{type:"primary",onClick:D.onSubmit,icon:"el-icon-search"},{default:(0,t.k6)((()=>[c])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])]),g,(0,t.bF)(T,{type:"primary",icon:"el-icon-plus",onClick:D.addCoupon,style:{"margin-top":"10px"}},{default:(0,t.k6)((()=>[h])),_:1},8,["onClick"]),p,(0,t.bF)(Q,{data:W.tableData,style:{width:"100%"}},{default:(0,t.k6)((()=>[(0,t.bF)(I,{prop:"id",width:"100px",label:"ID"}),(0,t.bF)(I,{prop:"name",label:"名称"}),(0,t.bF)(I,{label:"类型",prop:"type"},{default:(0,t.k6)((e=>[1==e.row.type?((0,t.uX)(),(0,t.Wv)(z,{key:0,type:"success"},{default:(0,t.k6)((()=>[m])),_:1})):(0,t.Q3)("",!0),2==e.row.type?((0,t.uX)(),(0,t.Wv)(z,{key:1},{default:(0,t.k6)((()=>[b])),_:1})):(0,t.Q3)("",!0)])),_:1}),(0,t.bF)(I,{label:"优惠金额/折扣"},{default:(0,t.k6)((e=>[1==e.row.type?((0,t.uX)(),(0,t.CE)("span",k,(0,o.v_)(e.row.amount),1)):(0,t.Q3)("",!0),2==e.row.type?((0,t.uX)(),(0,t.CE)("span",F,(0,o.v_)(e.row.discount),1)):(0,t.Q3)("",!0)])),_:1}),(0,t.bF)(I,{label:"领取上限"},{default:(0,t.k6)((e=>[(0,t.eW)((0,o.v_)(e.row.max_receive_num)+"张/人 ",1)])),_:1}),(0,t.bF)(I,{prop:"total_num",label:"发放数量"}),(0,t.bF)(I,{prop:"received_num",label:"已领数量"}),(0,t.bF)(I,{width:"400px",label:"有效期"},{default:(0,t.k6)((e=>[1==e.row.validity_type?((0,t.uX)(),(0,t.CE)("span",_,(0,o.v_)(e.row.start_time)+" / "+(0,o.v_)(e.row.end_time),1)):((0,t.uX)(),(0,t.CE)("span",f,"领取之日后 "+(0,o.v_)(e.row.receive_useful_day)+" 天",1))])),_:1}),(0,t.bF)(I,{label:"是否开启"},{default:(0,t.k6)((e=>[(0,t.bF)(P,{onChange:a=>D.changeOpen(a,e.row.id),modelValue:e.row.open_flag,"onUpdate:modelValue":a=>e.row.open_flag=a,"inactive-color":"#ccc","active-value":1,"inactive-value":2},null,8,["onChange","modelValue","onUpdate:modelValue"])])),_:1}),(0,t.bF)(I,{prop:"status_txt",label:"状态"}),(0,t.bF)(I,{label:"操作",width:"280"},{default:(0,t.k6)((e=>[(0,t.bF)(T,{onClick:a=>D.handleView(e.row),type:"text",size:"small"},{default:(0,t.k6)((()=>[v])),_:2},1032,["onClick"]),(0,t.bF)(T,{onClick:a=>D.handleLog(e.row),type:"text",size:"small"},{default:(0,t.k6)((()=>[C])),_:2},1032,["onClick"]),1==e.row.status?((0,t.uX)(),(0,t.Wv)(T,{key:0,onClick:a=>D.handleSend(e.row),type:"text",size:"small"},{default:(0,t.k6)((()=>[y])),_:2},1032,["onClick"])):(0,t.Q3)("",!0),(0,t.bF)(T,{onClick:a=>D.handleClose(e.row),type:"text",size:"small"},{default:(0,t.k6)((()=>[w])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),(0,t.bF)(A,{style:{"margin-top":"10px"},background:"",layout:"->, prev, pager, next","page-size":W.searchForm.limit,onCurrentChange:D.handlePageChange,total:W.page.total},null,8,["page-size","onCurrentChange","total"])])),_:1}),W.dialog.save?((0,t.uX)(),(0,t.Wv)(E,{key:0,ref:"saveDialog",onSuccess:D.handleSuccess,onClosed:a[5]||(a[5]=e=>W.dialog.save=!1)},null,8,["onSuccess"])):(0,t.Q3)("",!0),W.dialog.send?((0,t.uX)(),(0,t.Wv)(R,{key:1,ref:"sendDialog",onSuccess:D.handleSendSuccess,onClosed:a[6]||(a[6]=e=>W.dialog.send=!1)},null,8,["onSuccess"])):(0,t.Q3)("",!0),(0,t.bF)(B,{title:"领取记录",modelValue:W.dialog.log,"onUpdate:modelValue":a[8]||(a[8]=e=>W.dialog.log=e),width:"800px"},{default:(0,t.k6)((()=>[(0,t.Lk)("div",x,[(0,t.bF)(S,{inline:!0,model:W.logForm,class:"demo-form-inline"},{default:(0,t.k6)((()=>[(0,t.bF)($,{label:"用户ID"},{default:(0,t.k6)((()=>[(0,t.bF)(X,{modelValue:W.logForm.user_id,"onUpdate:modelValue":a[7]||(a[7]=e=>W.logForm.user_id=e),placeholder:"用户id",clearable:""},null,8,["modelValue"])])),_:1}),(0,t.bF)($,null,{default:(0,t.k6)((()=>[(0,t.bF)(T,{type:"primary",onClick:D.searchLog},{default:(0,t.k6)((()=>[L])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])]),(0,t.bF)(Q,{data:W.logTableData,style:{width:"100%"}},{default:(0,t.k6)((()=>[(0,t.bF)(I,{prop:"id",label:"ID"}),(0,t.bF)(I,{prop:"user_id",label:"领取人ID"}),(0,t.bF)(I,{prop:"username",label:"领取人"}),(0,t.bF)(I,{prop:"create_time",label:"领取时间"})])),_:1},8,["data"]),(0,t.bF)(A,{style:{"margin-top":"10px"},background:"",layout:"->, prev, pager, next","page-size":W.logForm.limit,onCurrentChange:D.handleLogPageChange,total:W.page.logTotal},null,8,["page-size","onCurrentChange","total"])])),_:1},8,["modelValue"])])),_:1})}var D=l(2840),T=l(6720),V={name:"coupon",components:{saveDialog:D["default"],sendDialog:T["default"]},data(){return{dialog:{save:!1,log:!1,send:!1},logTableData:[],logForm:{coupon_id:0,page:1,limit:15,user_id:""},searchForm:{status:"",name:"",page:1,limit:15},options:[{value:1,label:"进行中"},{value:2,label:"已作废"},{value:3,label:"已过期"},{value:4,label:"已领完"}],page:{total:0,logTotal:0},tableData:[]}},mounted(){this.getList()},methods:{onSubmit(){this.searchForm.page=1,this.getList()},addCoupon(){this.dialog.save=!0,this.$nextTick((()=>{this.$refs.saveDialog.open()}))},handlePageChange(e){this.searchForm.page=e,this.getList()},handleView(e){this.dialog.save=!0,this.$nextTick((()=>{this.$refs.saveDialog.open("show").setData(e)}))},handleLog(e){this.dialog.log=!0,this.logForm.coupon_id=e.id,this.getReceiveLog()},handleClose(e){this.$confirm("此操作将作废该优惠券, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{let a=await this.$API.coupon.del.get({id:e.id});0==a.code?(this.$message.success(a.msg),this.getList()):this.$message.error(a.msg)})).catch((()=>{}))},async getList(){let e=await this.$API.coupon.list.get(this.searchForm);this.tableData=e.data.rows,this.page.total=e.data.total},checkTab(e){this.searchForm.status=e,this.searchForm.page=1,this.getList()},handleSuccess(){this.searchForm.page=1,this.getList()},async changeOpen(e,a){let l=await this.$API.coupon.open.get({open_flag:e,id:a});0==l.code?this.$message.success(l.msg):this.$message.error(l.msg)},async getReceiveLog(){let e=await this.$API.coupon.log.get(this.logForm);this.logTableData=e.data.rows,this.page.logTotal=e.data.total},handleLogPageChange(e){this.logForm.page=e,this.getReceiveLog()},searchLog(){this.getReceiveLog()},handleSend(e){this.dialog.send=!0,this.$nextTick((()=>{this.$refs.sendDialog.open().setData(e)}))},handleSendSuccess(){this.dialog.send=!1}}},$=l(1456);const S=(0,$.A)(V,[["render",W],["__scopeId","data-v-70447ee4"]]);var X=S}}]);