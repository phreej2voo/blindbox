"use strict";(self["webpackChunkscui"]=self["webpackChunkscui"]||[]).push([[3266],{6405:function(e,t,a){a.r(t),a.d(t,{default:function(){return P}});var l=a(6252),i=a(3577);const o=e=>((0,l.dD)("data-v-5a3e6472"),e=e(),(0,l.Cn)(),e),d={class:"click-bar",style:{width:"300px",display:"flex"}},s=(0,l.Uk)("返回列表 "),n=o((()=>(0,l._)("span",{style:{"font-size":"14px","font-weight":"700","margin-left":"20px"}},"盲盒奖品详情",-1))),r={style:{display:"flex"}},b=(0,l.Uk)("添加奖品"),p={style:{"margin-top":"20px","margin-left":"50px"}},h=(0,l.Uk)(" 当前设定的概率为："),u=(0,l.Uk)("，必须配置满100%！ "),m=o((()=>(0,l._)("div",{style:{width:"100%",height:"0","border-bottom":"#e4e7ed 1px dashed","margin-top":"15px"}},null,-1))),c=(0,l.Uk)("%"),g={key:1},y={key:1},w=(0,l.Uk)("删除"),x=(0,l.Uk)("保存奖品"),_=(0,l.Uk)("生成箱子");function f(e,t,a,o,f,k){const D=(0,l.up)("el-icon-arrow-left"),W=(0,l.up)("el-icon"),v=(0,l.up)("el-card"),P=(0,l.up)("el-button"),V=(0,l.up)("el-tag"),$=(0,l.up)("el-table-column"),C=(0,l.up)("el-image"),U=(0,l.up)("el-option"),B=(0,l.up)("el-select"),I=(0,l.up)("el-input"),T=(0,l.up)("el-table"),F=(0,l.up)("el-form-item"),S=(0,l.up)("el-form"),j=(0,l.up)("Goods"),A=(0,l.up)("el-dialog"),q=(0,l.up)("el-main");return(0,l.wg)(),(0,l.j4)(q,null,{default:(0,l.w5)((()=>[(0,l.Wm)(v,{shadow:"false",style:{display:"flex"}},{default:(0,l.w5)((()=>[(0,l._)("div",d,[(0,l._)("div",{onClick:t[0]||(t[0]=e=>k.goBack()),style:{cursor:"pointer"}},[(0,l.Wm)(W,{class:"back-icon"},{default:(0,l.w5)((()=>[(0,l.Wm)(D)])),_:1}),s]),n])])),_:1}),(0,l.Wm)(v,{shadow:"never"},{default:(0,l.w5)((()=>[(0,l._)("div",r,[(0,l.Wm)(P,{type:"primary",icon:"el-icon-plus",onClick:k.addBlindbox,style:{"margin-top":"15px"}},{default:(0,l.w5)((()=>[b])),_:1},8,["onClick"]),(0,l._)("div",p,[h,(0,l.Wm)(V,{type:"danger"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(f.totalProbability)+"%",1)])),_:1}),u])]),m,(0,l.Wm)(T,{data:f.tableData,style:{width:"100%","margin-top":"20px"}},{default:(0,l.w5)((()=>[(0,l.Wm)($,{prop:"goods_name",label:"商品名称"}),(0,l.Wm)($,{label:"商品图片"},{default:(0,l.w5)((e=>[(0,l.Wm)(C,{src:e.row.goods_image.split(",")[0],style:{height:"36px",width:"36px"}},null,8,["src"])])),_:1}),(0,l.Wm)($,{label:"赏种"},{default:(0,l.w5)((e=>[(0,l.Wm)(B,{modelValue:e.row.tag_id,"onUpdate:modelValue":t=>e.row.tag_id=t,placeholder:"请选择",style:{width:"150px"},onChange:t=>k.selectType(e.$index)},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(f.goodsTag,(e=>((0,l.wg)(),(0,l.j4)(U,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),(0,l.Wm)($,{prop:"price",label:"售价"}),(0,l.Wm)($,{prop:"recovery_price",label:"可兑换哈希币"}),(0,l.Wm)($,{label:"中奖概率%"},{default:(0,l.w5)((e=>[e.row.tag_id>0?((0,l.wg)(),(0,l.j4)(I,{key:0,style:{width:"150px"},modelValue:e.row.probability,"onUpdate:modelValue":t=>e.row.probability=t,onBlur:k.resetProbaility},{append:(0,l.w5)((()=>[c])),_:2},1032,["modelValue","onUpdate:modelValue","onBlur"])):((0,l.wg)(),(0,l.iD)("span",g,"/"))])),_:1}),(0,l.Wm)($,{prop:"stock",label:"库存"},{default:(0,l.w5)((e=>[0!=e.row.tag_id?((0,l.wg)(),(0,l.j4)(I,{key:0,modelValue:e.row.stock,"onUpdate:modelValue":t=>e.row.stock=t,type:"number",onChange:k.changeProbaility,style:{width:"150px"}},null,8,["modelValue","onUpdate:modelValue","onChange"])):((0,l.wg)(),(0,l.iD)("span",y,"/"))])),_:1}),(0,l.Wm)($,{label:"操作",fixed:"right",width:"140"},{default:(0,l.w5)((e=>[(0,l.Wm)(P,{onClick:t=>k.handleDel(e.$index),type:"text",size:"small"},{default:(0,l.w5)((()=>[w])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),(0,l.Wm)(P,{type:"danger",icon:"el-icon-document",onClick:k.saveBlindbox,style:{"margin-top":"15px"}},{default:(0,l.w5)((()=>[x])),_:1},8,["onClick"])])),_:1}),1!=f.playId||f.hasSet?(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(v,{key:0,shadow:"never"},{default:(0,l.w5)((()=>[(0,l.Wm)(S,{ref:"form",model:f.boxForm,"label-width":"80px"},{default:(0,l.w5)((()=>[(0,l.Wm)(F,{label:"箱子数量"},{default:(0,l.w5)((()=>[(0,l.Wm)(I,{modelValue:f.boxForm.num,"onUpdate:modelValue":t[1]||(t[1]=e=>f.boxForm.num=e),type:"number",style:{width:"300px"}},null,8,["modelValue"])])),_:1}),(0,l.Wm)(P,{type:"danger",icon:"el-icon-document",onClick:k.makeBox,style:{"margin-top":"15px"}},{default:(0,l.w5)((()=>[_])),_:1},8,["onClick"])])),_:1},8,["model"])])),_:1})),(0,l.Wm)(A,{title:"奖品选择",modelValue:f.dialog.goods,"onUpdate:modelValue":t[2]||(t[2]=e=>f.dialog.goods=e),"destroy-on-close":"",width:"50%"},{default:(0,l.w5)((()=>[(0,l.Wm)(j,{selectedgoods:f.selectedGoods,onHandleSelected:k.handleSelected,"goods-type":2},null,8,["selectedgoods","onHandleSelected"])])),_:1},8,["modelValue"])])),_:1})}a(7658);var k=a(9510),D={name:"goodsCate",components:{Goods:k.Z},data(){return{dialog:{save:!1,goods:!1},boxForm:{blindbox_id:this.$route.query.id,num:0},tableData:[],blindbox_id:this.$route.query.id,totalProbability:0,goodsTag:[],hasSet:!1,playId:this.$route.query.play_id,selectedGoods:[]}},mounted(){this.getList(),this.getBlindboxTag()},methods:{changeProbaility(){this.totalProbability=0;let e=0;this.tableData.forEach((t=>{e+=parseInt(t.stock)})),this.tableData.forEach(((t,a)=>{this.tableData[a].probability=0==e?parseInt(0):(t.stock/e*100).toFixed(3),this.totalProbability+=1e3*this.tableData[a].probability})),this.totalProbability=(this.totalProbability/1e3).toFixed(3)},resetProbaility(){this.totalProbability=0,this.tableData.forEach((e=>{this.totalProbability+=1e3*e.probability})),this.totalProbability=(this.totalProbability/1e3).toFixed(3)},addBlindbox(){this.dialog.goods=!0},handleEdit(e){this.dialog.save=!0,this.$nextTick((()=>{this.$refs.saveDialog.open("edit").setData(e)}))},handleDel(e){this.tableData.splice(e,1),this.changeProbaility()},async getList(){let e=await this.$API.blindboxDetail.list.get({blindbox_id:this.blindbox_id});this.tableData=e.data,e.data.length>0&&(this.hasSet=!0),this.resetProbaility()},handleSuccess(){this.getList()},async getBlindboxTag(){let e=await this.$API.blindboxTag.list.get({limit:9999999,page:1,status:1,hashmart_auth_skip:1});this.goodsTag=e.data.rows,1==this.playId&&this.goodsTag.push({id:0,name:"LAST"})},goBack(){this.$router.push({path:"/blindbox/index"})},async saveBlindbox(){if(100!=this.totalProbability)return this.$message.error("当前概率设置错误，总概率不是100%"),!1;let e=await this.$API.blindboxDetail.add.post({play_id:this.playId,data:this.tableData,blindbox_id:this.blindbox_id});0==e.code?this.$message.success("保存成功"):this.$message.error(e.msg)},handleSelected(e){this.tableData.push({blindbox_id:this.blindbox_id,tag_id:"",goods_id:e[0].id,goods_name:e[0].name,goods_image:e[0].image,price:e[0].price,recovery_price:e[0].recovery_price,stock:1,probability:0}),this.dialog.goods=!1},selectType(e){let t=this.tableData[e].tag_id;t<=0?(this.tableData[e].probability=0,this.tableData[e].stock=1):this.changeProbaility()},async makeBox(){if(this.boxForm.num<=0)return this.$message.error("箱子数量必须大于0"),!1;let e=await this.$API.blindboxDetail.box.post(this.boxForm);0==e.code?this.$message.success("生成箱子成功"):this.$message.error(e.msg)}}},W=a(3744);const v=(0,W.Z)(D,[["render",f],["__scopeId","data-v-5a3e6472"]]);var P=v}}]);