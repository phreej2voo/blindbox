"use strict";(self["webpackChunkscui"]=self["webpackChunkscui"]||[]).push([[3153],{4844:function(e,a,t){t.r(a),t.d(a,{default:function(){return J}});var l=t(6252),o=t(3577);const i=(0,l.Uk)("周卡"),s=(0,l.Uk)("月卡"),r=(0,l.Uk)("批量设置"),m={key:0,class:"month-box"},d={class:"title"},u=["onClick"],n={key:0},p={key:1,class:"month-box",style:{"flex-wrap":"wrap",width:"990px"}},c={class:"title"},w=["onClick"],h={key:0},f=(0,l.Uk)(" （-1表示无限制） "),y=(0,l.Uk)(" （-1表示无限制） "),g=(0,l.Uk)("正常"),k=(0,l.Uk)("作废"),D=(0,l.Uk)(" 提交 "),b=(0,l.Uk)("添加"),v=(0,l.Uk)(" 使用设置 "),_={key:0},V={key:1},W={key:0},U={key:1},C=(0,l.Uk)("删除"),x=(0,l.Uk)("添加"),Z=(0,l.Uk)(" 使用设置 "),q={key:0},R={key:1},S={key:0},T={key:1},z=(0,l.Uk)("删除");function I(e,a,t,I,O,$){const K=(0,l.up)("el-input"),B=(0,l.up)("el-form-item"),L=(0,l.up)("el-radio"),N=(0,l.up)("el-button"),P=(0,l.up)("el-form"),Y=(0,l.up)("el-card"),H=(0,l.up)("resource"),J=(0,l.up)("el-dialog"),A=(0,l.up)("el-table-column"),M=(0,l.up)("el-table"),F=(0,l.up)("el-main");return(0,l.wg)(),(0,l.j4)(F,null,{default:(0,l.w5)((()=>[(0,l.Wm)(Y,{shadow:"never"},{default:(0,l.w5)((()=>[(0,l.Wm)(P,{model:O.form,"label-width":"150px",rules:O.formRules,ref:"ruleForm"},{default:(0,l.w5)((()=>[(0,l.Wm)(B,{label:"会员卡名",prop:"title"},{default:(0,l.w5)((()=>[(0,l.Wm)(K,{style:{width:"500px"},modelValue:O.form.title,"onUpdate:modelValue":a[0]||(a[0]=e=>O.form.title=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),(0,l.Wm)(B,{label:"类型",prop:"type"},{default:(0,l.w5)((()=>[(0,l.Wm)(L,{modelValue:O.form.type,"onUpdate:modelValue":a[1]||(a[1]=e=>O.form.type=e),label:1},{default:(0,l.w5)((()=>[i])),_:1},8,["modelValue"]),(0,l.Wm)(L,{modelValue:O.form.type,"onUpdate:modelValue":a[2]||(a[2]=e=>O.form.type=e),label:2},{default:(0,l.w5)((()=>[s])),_:1},8,["modelValue"])])),_:1}),(0,l.Wm)(B,{label:"设置会员卡",class:"set-card"},{default:(0,l.w5)((()=>[(0,l._)("div",null,[(0,l.Wm)(N,{type:"primary",onClick:$.batchSet},{default:(0,l.w5)((()=>[r])),_:1},8,["onClick"])]),1==O.form.type?((0,l.wg)(),(0,l.iD)("div",m,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(O.sevenDay,((e,a)=>((0,l.wg)(),(0,l.iD)("div",{class:"card-item",key:e.day},[(0,l._)("div",d,[(0,l.Uk)(" 第"+(0,o.zw)(e.day)+"天 ",1),(0,l._)("span",{style:{color:"#409eff",cursor:"pointer","margin-left":"80px"},onClick:e=>$.editCard(a)},"设置",8,u)]),(0,l._)("ul",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.award,((e,a)=>((0,l.wg)(),(0,l.iD)("li",{key:a},[(0,l.Uk)((0,o.zw)(e.name)+" ",1),"balance"==e.type?((0,l.wg)(),(0,l.iD)("span",n,(0,o.zw)(e.value),1)):(0,l.kq)("",!0),(0,l.Uk)(" * "+(0,o.zw)(e.num),1)])))),128))])])))),128))])):(0,l.kq)("",!0),2==O.form.type?((0,l.wg)(),(0,l.iD)("div",p,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(O.monthDay,((e,a)=>((0,l.wg)(),(0,l.iD)("div",{class:"card-item",key:e.day},[(0,l._)("div",c,[(0,l.Uk)(" 第"+(0,o.zw)(e.day)+"天 ",1),(0,l._)("span",{style:{color:"#409eff",cursor:"pointer","margin-left":"70px"},onClick:e=>$.editCard(a)},"设置",8,w)]),(0,l._)("ul",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.award,((e,a)=>((0,l.wg)(),(0,l.iD)("li",{key:a},[(0,l.Uk)((0,o.zw)(e.name)+" ",1),"balance"==e.type?((0,l.wg)(),(0,l.iD)("span",h,(0,o.zw)(e.value),1)):(0,l.kq)("",!0),(0,l.Uk)(" * "+(0,o.zw)(e.num),1)])))),128))])])))),128))])):(0,l.kq)("",!0)])),_:1}),(0,l.Wm)(B,{label:"价格",prop:"price"},{default:(0,l.w5)((()=>[(0,l.Wm)(K,{style:{width:"500px"},modelValue:O.form.price,"onUpdate:modelValue":a[3]||(a[3]=e=>O.form.price=e),autocomplete:"off",type:"number"},null,8,["modelValue"])])),_:1}),(0,l.Wm)(B,{label:"库存",prop:"stock"},{default:(0,l.w5)((()=>[(0,l.Wm)(K,{style:{width:"500px"},modelValue:O.form.stock,"onUpdate:modelValue":a[4]||(a[4]=e=>O.form.stock=e),autocomplete:"off",type:"number"},null,8,["modelValue"]),f])),_:1}),(0,l.Wm)(B,{label:"每人限制",prop:"one_limit"},{default:(0,l.w5)((()=>[(0,l.Wm)(K,{style:{width:"500px"},modelValue:O.form.one_limit,"onUpdate:modelValue":a[5]||(a[5]=e=>O.form.one_limit=e),autocomplete:"off",type:"number"},null,8,["modelValue"]),y])),_:1}),(0,l.Wm)(B,{label:"描述"},{default:(0,l.w5)((()=>[(0,l.Wm)(K,{style:{width:"500px"},modelValue:O.form.description,"onUpdate:modelValue":a[6]||(a[6]=e=>O.form.description=e),autocomplete:"off",rows:8,type:"textarea"},null,8,["modelValue"])])),_:1}),(0,l.Wm)(B,{label:"状态",prop:"status"},{default:(0,l.w5)((()=>[(0,l.Wm)(L,{modelValue:O.form.status,"onUpdate:modelValue":a[7]||(a[7]=e=>O.form.status=e),label:1},{default:(0,l.w5)((()=>[g])),_:1},8,["modelValue"]),(0,l.Wm)(L,{modelValue:O.form.status,"onUpdate:modelValue":a[8]||(a[8]=e=>O.form.status=e),label:2},{default:(0,l.w5)((()=>[k])),_:1},8,["modelValue"])])),_:1}),(0,l.Wm)(B,null,{default:(0,l.w5)((()=>[(0,l.Wm)(N,{type:"primary",class:"button-item",onClick:$.onSubmit,loading:e.btnloading},{default:(0,l.w5)((()=>[D])),_:1},8,["onClick","loading"])])),_:1})])),_:1},8,["model","rules"])])),_:1}),(0,l.Wm)(J,{title:"选择资源",modelValue:O.imgResourceVisible,"onUpdate:modelValue":a[9]||(a[9]=e=>O.imgResourceVisible=e),width:1350,"destroy-on-close":"","close-on-click-modal":!1},{default:(0,l.w5)((()=>[(0,l.Wm)(H,{onSelectedResource:$.handleResource},null,8,["onSelectedResource"])])),_:1},8,["modelValue"]),(0,l.Wm)(J,{title:"批量设置",modelValue:O.awardBatchDialog,"onUpdate:modelValue":a[11]||(a[11]=e=>O.awardBatchDialog=e),width:700,"destroy-on-close":"","close-on-click-modal":!1},{default:(0,l.w5)((()=>[(0,l.Wm)(N,{type:"primary",onClick:a[10]||(a[10]=e=>$.showResource(1))},{default:(0,l.w5)((()=>[b])),_:1}),(0,l.Wm)(N,{type:"success",onClick:$.saveSet},{default:(0,l.w5)((()=>[v])),_:1},8,["onClick"]),(0,l.Wm)(M,{data:O.awardDay,style:{width:"100%","margin-top":"10px"},border:""},{default:(0,l.w5)((()=>[(0,l.Wm)(A,{label:"类型"},{default:(0,l.w5)((e=>["balance"==e.row.type?((0,l.wg)(),(0,l.iD)("span",_,"余额")):(0,l.kq)("",!0),"coupon"==e.row.type?((0,l.wg)(),(0,l.iD)("span",V,"优惠券")):(0,l.kq)("",!0)])),_:1}),(0,l.Wm)(A,{prop:"name",label:"名称"}),(0,l.Wm)(A,{label:"数量"},{default:(0,l.w5)((e=>["balance"==e.row.type?((0,l.wg)(),(0,l.iD)("span",W,(0,o.zw)(e.row.value),1)):((0,l.wg)(),(0,l.iD)("span",U,(0,o.zw)(e.row.num),1))])),_:1}),(0,l.Wm)(A,{label:"操作"},{default:(0,l.w5)((e=>[(0,l.Wm)(N,{onClick:a=>$.handleDel(e.$index),type:"text",size:"small"},{default:(0,l.w5)((()=>[C])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue"]),(0,l.Wm)(J,{title:"单独设置",modelValue:O.awardDialog,"onUpdate:modelValue":a[13]||(a[13]=e=>O.awardDialog=e),width:700,"destroy-on-close":"","close-on-click-modal":!1},{default:(0,l.w5)((()=>[(0,l.Wm)(N,{type:"primary",onClick:a[12]||(a[12]=e=>$.showResource(2))},{default:(0,l.w5)((()=>[x])),_:1}),(0,l.Wm)(N,{type:"success",onClick:$.saveSet},{default:(0,l.w5)((()=>[Z])),_:1},8,["onClick"]),(0,l.Wm)(M,{data:O.awardOneDay,style:{width:"100%","margin-top":"10px"},border:""},{default:(0,l.w5)((()=>[(0,l.Wm)(A,{label:"类型"},{default:(0,l.w5)((e=>["balance"==e.row.type?((0,l.wg)(),(0,l.iD)("span",q,"余额")):(0,l.kq)("",!0),"coupon"==e.row.type?((0,l.wg)(),(0,l.iD)("span",R,"优惠券")):(0,l.kq)("",!0)])),_:1}),(0,l.Wm)(A,{prop:"name",label:"名称"}),(0,l.Wm)(A,{label:"数量"},{default:(0,l.w5)((e=>["balance"==e.row.type?((0,l.wg)(),(0,l.iD)("span",S,(0,o.zw)(e.row.value),1)):((0,l.wg)(),(0,l.iD)("span",T,(0,o.zw)(e.row.num),1))])),_:1}),(0,l.Wm)(A,{label:"操作"},{default:(0,l.w5)((e=>[(0,l.Wm)(N,{onClick:a=>$.handleDel(e.$index),type:"text",size:"small"},{default:(0,l.w5)((()=>[z])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue"])])),_:1})}t(7658);var O=t(7087),$=t(4865),K=t.n($),B=t(2314),L=t(4239),N={refresh(){K().start();const e=B.Z.currentRoute.value;L.Z.commit("removeKeepLive",e.name),L.Z.commit("setRouteShow",!1),(0,l.Y3)((()=>{L.Z.commit("pushKeepLive",e.name),L.Z.commit("setRouteShow",!0),K().done()}))},close(e){const a=e||B.Z.currentRoute.value;L.Z.commit("removeViewTags",a),L.Z.commit("removeIframeList",a),L.Z.commit("removeKeepLive",a.name);const t=L.Z.state.viewTags.viewTags,l=t.slice(-1)[0];l?B.Z.push(l):B.Z.push("/")},closeNext(e){const a=B.Z.currentRoute.value;if(L.Z.commit("removeViewTags",a),L.Z.commit("removeIframeList",a),L.Z.commit("removeKeepLive",a.name),e){const a=L.Z.state.viewTags.viewTags;e(a)}},closeOther(){const e=B.Z.currentRoute.value,a=[...L.Z.state.viewTags.viewTags];a.forEach((a=>{if(a.meta&&a.meta.affix||e.fullPath==a.fullPath)return!0;this.close(a)}))},setTitle(e){L.Z.commit("updateViewTagsTitle",e)}},P={components:{resource:O.Z},data(){return{form:{type:1,title:"",price:0,stock:-1,one_limit:-1,description:"",status:1,equity:""},imgResourceVisible:!1,formRules:{title:[{required:!0,message:"请输入会员卡名",trigger:"blur"}],type:[{required:!0,message:"会员卡类型",trigger:"blur"}],price:[{required:!0,message:"请输入价格",trigger:"blur"}],stock:[{required:!0,message:"请输入库存",trigger:"blur"}],one_limit:[{required:!0,message:"累计购买限制",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"blur"}]},sevenDay:[],monthDay:[],awardDay:[],awardOneDay:[],awardBatchDialog:!1,awardDialog:!1,resourceType:1,nowIndex:0}},mounted(){this.initDayMap(7),this.initDayMap(30),"edit"==this.$route.query.type&&this.getCardInfo(this.$route.query.id)},methods:{async onSubmit(){this.$refs.ruleForm.validate((async e=>{if(e){let e;1==this.form.type?this.form.equity=this.sevenDay:this.form.equity=this.monthDay,e=this.form.id?await this.$API.vipCard.edit.post(this.form):await this.$API.vipCard.add.post(this.form),0==e.code?(this.$message.success(e.msg),N.close(),setTimeout((()=>{this.$router.push("/vip/card")}),500)):this.$message.error(e.msg)}}))},initDayMap(e){for(let a=0;a<e;a++)7==e?this.sevenDay.push({day:a+1,award:[]}):this.monthDay.push({day:a+1,award:[]})},batchSet(){this.awardBatchDialog=!0},editCard(e){let a;this.awardDialog=!0,a=1==this.form.type?this.sevenDay[e].award:this.monthDay[e].award,this.awardOneDay=JSON.parse(JSON.stringify(a)),this.nowIndex=e},showResource(e){this.resourceType=e,this.imgResourceVisible=!0},handleResource(e){this.imgResourceVisible=!1,1==this.resourceType?this.awardDay.push(e):this.awardOneDay.push(e)},handleDel(e){this.awardBatchDialog&&this.awardDay.splice(e,1),this.awardDialog&&this.awardOneDay.splice(e,1)},saveSet(){if(this.awardBatchDialog)if(this.awardBatchDialog=!1,1==this.form.type)for(let e=0;e<7;e++)this.sevenDay[e].award=this.awardDay;else for(let e=0;e<30;e++)this.monthDay[e].award=this.awardDay;this.awardDialog&&(this.awardDialog=!1,1==this.form.type?this.sevenDay[this.nowIndex].award=this.awardOneDay:this.monthDay[this.nowIndex].award=this.awardOneDay)},async getCardInfo(e){let a=await this.$API.vipCard.info.get({id:e}),t=a.data;this.form.id=t.id,this.form.type=t.type,this.form.title=t.title,this.form.price=t.price,this.form.stock=t.stock,this.form.one_limit=t.one_limit,this.form.description=t.description,this.form.status=t.status,1==this.form.type?this.sevenDay=JSON.parse(t.equity):this.monthDay=JSON.parse(t.equity)}}},Y=t(3744);const H=(0,Y.Z)(P,[["render",I],["__scopeId","data-v-44359e86"]]);var J=H}}]);